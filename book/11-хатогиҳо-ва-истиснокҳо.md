# Боби 11: Хатогиҳо ва истиснокҳо

## 11.1. Муқаддима

Идораи хатогиҳо яке аз ҷанбаҳои муҳими барномасозӣ аст. SomonScript механизми пурқувват барои коркарди хатогиҳо пешниҳод мекунад.

## 11.2. Блоки КӮШИШ-ГИРИФТАН-НИҲОЯТ

### 11.2.1. Сохтори асосӣ

```somonscript
кӯшиш {
    // Коде ки метавонад хато диҳад
    тағйирёбанда натиҷа: рақам = 10 / 0;
    чоп.сабт(натиҷа);
} гирифтан (хато) {
    // Коркарди хато
    чоп.хато("Хато рӯй дод: " + хато);
}
```

### 11.2.2. Блоки НИҲОЯТ

Блоки `ниҳоят` ҳамеша иҷро мешавад, на аз он ки хато рӯй дода бошад ё не.

```somonscript
функсия хондани_файл(номи_файл: сатр): холӣ {
    тағйирёбанда файл: ҳар = холӣ;

    кӯшиш {
        файл = кушодани_файл(номи_файл);
        тағйирёбанда маълумот: сатр = хондан(файл);
        чоп.сабт(маълумот);
    } гирифтан (хато) {
        чоп.хато("Хато ҳангоми хондани файл: " + хато);
    } ниҳоят {
        агар (файл !== холӣ) {
            бастани_файл(файл);
            чоп.сабт("Файл баста шуд");
        }
    }
}
```

## 11.3. Партофтани истиснокҳо

Шумо метавонед худатон истиснок партоед бо истифода аз `партофтан`.

```somonscript
функсия тақсим_кардан(а: рақам, б: рақам): рақам {
    агар (б === 0) {
        партофтан нав Хато("Тақсим ба сифр ғайриқонунӣ аст!");
    }
    бозгашт а / б;
}

кӯшиш {
    тағйирёбанда натиҷа: рақам = тақсим_кардан(10, 0);
    чоп.сабт(натиҷа);
} гирифтан (хато) {
    чоп.хато("Хато: " + хато.паём);
}
```

## 11.4. Синфҳои хатогии фармоишӣ

Шумо метавонед синфҳои хатогии худро эҷод кунед.

```somonscript
// Синфи хатогии фармоишӣ
синф Хатои_тасдиқ мерос Хато {
    конструктор(паём: сатр) {
        супер(паём);
        ин.ном = "Хатои_тасдиқ";
    }
}

синф Хатои_дастрасӣ мерос Хато {
    конструктор(паём: сатр) {
        супер(паём);
        ин.ном = "Хатои_дастрасӣ";
    }
}

// Истифода
функсия тасдиқи_синну_сол(синну_сол: рақам): холӣ {
    агар (синну_сол < 0) {
        партофтан нав Хатои_тасдиқ("Синну сол набояд манфӣ бошад");
    }
    агар (синну_сол > 150) {
        партофтан нав Хатои_тасдиқ("Синну соли беҳад калон");
    }
    чоп.сабт("Синну сол дуруст аст: " + синну_сол);
}

кӯшиш {
    тасдиқи_синну_сол(-5);
} гирифтан (хато) {
    агар (хато instanceof Хатои_тасдиқ) {
        чоп.хато("Хатои тасдиқ: " + хато.паём);
    } вагарна {
        чоп.хато("Хатои номаълум: " + хато);
    }
}
```

## 11.5. Санҷиши намуди хато

```somonscript
функсия коркарди_хато(хато: ҳар): холӣ {
    агар (хато instanceof Хатои_тасдиқ) {
        чоп.хато("Тасдиқ ғайридуруст: " + хато.паём);
    } вагарна агар (хато instanceof Хатои_дастрасӣ) {
        чоп.хато("Дастрасӣ рад карда шуд: " + хато.паём);
    } вагарна агар (хато instanceof Хато) {
        чоп.хато("Хато: " + хато.паём);
    } вагарна {
        чоп.хато("Хатои номаълум");
    }
}

кӯшиш {
    партофтан нав Хатои_тасдиқ("Маълумоти нодуруст");
} гирифтан (хато) {
    коркарди_хато(хато);
}
```

## 11.6. Мисолҳои амалӣ

### Мисоли 1: Тасдиқи маълумоти корбар

```somonscript
синф Хатои_маълумоти_корбар мерос Хато {
    конструктор(паём: сатр) {
        супер(паём);
        ин.ном = "Хатои_маълумоти_корбар";
    }
}

функсия тасдиқи_email(email: сатр): мантиқӣ {
    // Тасдиқи оддӣ
    агар (!email.дорад("@")) {
        партофтан нав Хатои_маълумоти_корбар("Email бояд @ дошта бошад");
    }
    бозгашт дуруст;
}

функсия тасдиқи_парол(парол: сатр): мантиқӣ {
    агар (парол.дарозӣ < 8) {
        партофтан нав Хатои_маълумоти_корбар("Парол бояд ҳадди ақал 8 аломат дошта бошад");
    }
    бозгашт дуруст;
}

функсия сабти_корбар(email: сатр, парол: сатр): холӣ {
    кӯшиш {
        тасдиқи_email(email);
        тасдиқи_парол(парол);
        чоп.сабт("Корбар бомуваффақият сабт карда шуд!");
    } гирифтан (хато) {
        агар (хато instanceof Хатои_маълумоти_корбар) {
            чоп.хато("Хатои тасдиқ: " + хато.паём);
        } вагарна {
            чоп.хато("Хатои номаълум рӯй дод");
        }
    }
}

// Санҷиш
сабти_корбар("test@example.com", "password123");  // Дуруст
сабти_корбар("test-example.com", "password123");  // Хато: email
сабти_корбар("test@example.com", "123");          // Хато: парол
```

### Мисоли 2: Идораи хатогиҳои асинхронӣ

```somonscript
ҳамзамон функсия гирифтани_маълумот(ид: рақам): ваъда<объект> {
    кӯшиш {
        // Симулятсияи дархост ба сервер
        агар (ид <= 0) {
            партофтан нав Хато("ID бояд мусбат бошад");
        }

        // Симулятсияи интизорӣ
        интизор таваққуф(1000);

        бозгашт {
            ид: ид,
            ном: "Корбари " + ид,
            синну_сол: 20 + ид
        };
    } гирифтан (хато) {
        чоп.хато("Хато ҳангоми гирифтани маълумот: " + хато.паём);
        партофтан хато;
    }
}

// Истифода
ҳамзамон функсия асосӣ(): холӣ {
    кӯшиш {
        тағйирёбанда маълумот: объект = интизор гирифтани_маълумот(5);
        чоп.сабт("Маълумот гирифта шуд:", маълумот);

        // Кӯшиш бо ID нодуруст
        тағйирёбанда маълумоти_нодуруст: объект = интизор гирифтани_маълумот(-1);
    } гирифтан (хато) {
        чоп.хато("Хатои умумӣ: " + хато.паём);
    }
}

асосӣ();
```

### Мисоли 3: Системаи идораи хатогиҳо

```somonscript
синф Сабткунандаи_хатогиҳо {
    хосусӣ хатогиҳо: объект[];

    конструктор() {
        ин.хатогиҳо = [];
    }

    ҷамъиятӣ сабт_кардан(хато: Хато, контекст: сатр = ""): холӣ {
        тағйирёбанда сабт: объект = {
            вақт: нав Сана(),
            ном: хато.ном,
            паём: хато.паём,
            контекст: контекст
        };
        ин.хатогиҳо.илова(сабт);
        чоп.хато(`[${сабт.вақт}] ${хато.ном}: ${хато.паём}`);
    }

    ҷамъиятӣ гирифтани_хатогиҳо(): объект[] {
        бозгашт ин.хатогиҳо;
    }

    ҷамъиятӣ полиз(): холӣ {
        ин.хатогиҳо = [];
    }

    ҷамъиятӣ намоиш(): холӣ {
        чоп.сабт("\n=== Сабти хатогиҳо ===");
        барои (тағйирёбанда и: рақам = 0; и < ин.хатогиҳо.дарозӣ; и++) {
            тағйирёбанда х: объект = ин.хатогиҳо[и];
            чоп.сабт(`${и + 1}. [${х.ном}] ${х.паём}`);
            агар (х.контекст) {
                чоп.сабт(`   Контекст: ${х.контекст}`);
            }
        }
    }
}

// Истифода
тағйирёбанда сабткунанда = нав Сабткунандаи_хатогиҳо();

функсия амалиёти_хавфнок(): холӣ {
    кӯшиш {
        партофтан нав Хато("Хатои симулятсияшуда");
    } гирифтан (хато) {
        сабткунанда.сабт_кардан(хато, "амалиёти_хавфнок()");
    }
}

амалиёти_хавфнок();
сабткунанда.намоиш();
```

## 11.7. Хатогиҳои маъмул

### Хатогиҳои синтаксисӣ

```somonscript
// Ин хато ҳангоми компилятсия муайян карда мешавад
// тағйирёбанда х = ;  // ХАТО: Ибораи нодуруст
```

### Хатогиҳои ҳангоми иҷро

```somonscript
кӯшиш {
    тағйирёбанда х: холӣ = холӣ;
    чоп.сабт(х.ном);  // Хато: Намешавад хосияти 'ном'-ро аз холӣ хонд
} гирифтан (хато) {
    чоп.хато("Хатои ҳангоми иҷро: " + хато.паём);
}
```

## 11.8. Хулоса

Дар ин боб шумо омӯхтед:
- Блокҳои кӯшиш-гирифтан-ниҳоят
- Партофтани истиснокҳо
- Синфҳои хатогии фармоишӣ
- Санҷиши намуди хато
- Усулҳои беҳтарин барои идораи хатогиҳо

---

**Машқҳо:**

1. Функсияе нависед, ки синну солро тасдиқ мекунад ва дар ҳолати нодуруст истиснок мепартояд
2. Системаи сабти хатогиҳо эҷод кунед, ки хатогиҳоро ба файл менависад
3. Синфи хатогии фармоишӣ барои "Хатои базаи маълумот" созед
4. Функсияи асинхронӣ эҷод кунед, ки хатогиҳоро дуруст коркард мекунад
