# Боби 10: Системаи намудҳо (Type System)

## 10.1. Муқаддима

SomonScript системаи намудҳои пешрафтаеро дорад, ки аз TypeScript илҳом гирифтааст. Ин система имкон медиҳад, ки хатогиҳоро пеш аз иҷрои барнома пайдо кунед.

## 10.2. Намудҳои Union (Иттиҳодӣ)

Намудҳои union имкон медиҳанд, ки тағйирёбанда метавонад яке аз чанд намуд дошта бошад.

```somonscript
// Тағйирёбанда метавонад сатр ё рақам бошад
тағйирёбанда қимат: сатр | рақам;

қимат = "Салом";
чоп.сабт(қимат);  // Салом

қимат = 42;
чоп.сабт(қимат);  // 42

// Функсия бо намуди union
функсия чопи_идентификатор(ид: сатр | рақам): холӣ {
    агар (навъи ид === "сатр") {
        чоп.сабт("ID (сатр): " + ид);
    } вагарна {
        чоп.сабт("ID (рақам): " + ид);
    }
}

чопи_идентификатор("ABC123");
чопи_идентификатор(12345);
```

## 10.3. Намудҳои Intersection (Кисмҳои якҷоя)

Намудҳои intersection якчанд намудро ба як намуд муттаҳид мекунанд.

```somonscript
// Таърифи намудҳо
навъ Ном = {
    ном: сатр;
    фамилия: сатр;
};

навъ Тамос = {
    email: сатр;
    телефон: сатр;
};

// Иттиҳоди намудҳо
навъ Корбар = Ном & Тамос;

// Истифода
тағйирёбанда корбар: Корбар = {
    ном: "Аҳмад",
    фамилия: "Раҳимов",
    email: "ahmad@example.com",
    телефон: "+992901234567"
};

чоп.сабт(корбар.ном);
чоп.сабт(корбар.email);
```

## 10.4. Намудҳои Tuple (Кортеж)

Tuple массиви бо шумораи муайян ва намудҳои муайяни элементҳо аст.

```somonscript
// Эълони tuple
тағйирёбанда нуқта: [рақам, рақам] = [10, 20];
тағйирёбанда шахс: [сатр, рақам, мантиқӣ] = ["Аҳмад", 25, дуруст];

чоп.сабт("Координатаҳо: " + нуқта[0] + ", " + нуқта[1]);
чоп.сабт("Ном: " + шахс[0]);
чоп.сабт("Синну сол: " + шахс[1]);
чоп.сабт("Фаъол: " + шахс[2]);

// Tuple дар функсия
функсия гирифтани_координатаҳо(): [рақам, рақам] {
    бозгашт [100, 200];
}

тағйирёбанда макон: [рақам, рақам] = гирифтани_координатаҳо();
чоп.сабт(`х: ${макон[0]}, у: ${макон[1]}`);
```

## 10.5. Намуди Partial (Қисмӣ)

Намуди partial ҳамаи хосиятҳоро ихтиёрӣ мегардонад.

```somonscript
интерфейс Корбар {
    ном: сатр;
    синну_сол: рақам;
    email: сатр;
}

// Истифодаи қисмӣ - на ҳамаи хосиятҳо ҳатмӣ
тағйирёбанда тағйиротҳо: қисмӣ<Корбар> = {
    синну_сол: 26  // Танҳо синну солро тағйир медиҳем
};

чоп.сабт(тағйиротҳо.синну_сол);
```

## 10.6. Намуди Required (Ҳатмӣ)

Намуди required ҳамаи хосиятҳоро ҳатмӣ мегардонад.

```somonscript
интерфейс Танзимот {
    ранг?: сатр;
    андоза?: рақам;
}

// Ҳамаи хосиятҳоро ҳатмӣ мекунем
тағйирёбанда танзимоти_пурра: ҳатмӣ<Танзимот> = {
    ранг: "сурх",
    андоза: 14
};
```

## 10.7. Намуди Readonly (Танҳохонӣ)

Намуди readonly хосиятҳоро ғайриқобили тағйир мегардонад.

```somonscript
интерфейс Нуқта {
    танҳохонӣ х: рақам;
    танҳохонӣ у: рақам;
}

тағйирёбанда нуқта: Нуқта = { х: 10, у: 20 };

чоп.сабт(нуқта.х);  // 10

// нуқта.х = 30;  // ХАТО! Хосияти танҳохонӣ
```

## 10.8. Навъҳои шартӣ (Conditional Types)

```somonscript
// Намуди шартӣ
навъ Навъи_бозгашт<Т> = Т мерос сатр ? рақам : мантиқӣ;

// Истифода
тағйирёбанда натиҷа1: Навъи_бозгашт<сатр> = 42;      // рақам
тағйирёбанда натиҷа2: Навъи_бозгашт<рақам> = дуруст;  // мантиқӣ
```

## 10.9. Намудҳои utility

### 10.9.1. Pick (Интихоб)

```somonscript
интерфейс Корбар {
    ном: сатр;
    синну_сол: рақам;
    email: сатр;
    телефон: сатр;
}

// Интихоби танҳо баъзе хосиятҳо
навъ Намуди_корбар = Pick<Корбар, "ном" | "email">;

тағйирёбанда корбар: Намуди_корбар = {
    ном: "Аҳмад",
    email: "ahmad@example.com"
};
```

### 10.9.2. Omit (Ҳазф)

```somonscript
интерфейс Корбар {
    ном: сатр;
    синну_сол: рақам;
    парол: сатр;
}

// Ҳазфи баъзе хосиятҳо
навъ Корбари_ҷамъиятӣ = Omit<Корбар, "парол">;

тағйирёбанда корбар: Корбари_ҷамъиятӣ = {
    ном: "Аҳмад",
    синну_сол: 25
    // парол нест
};
```

### 10.9.3. Record (Сабт)

```somonscript
// Эҷоди объект бо калидҳои муайян
навъ Бахоҳо = сабт<сатр, рақам>;

тағйирёбанда бахоҳои_донишҷӯ: Бахоҳо = {
    математика: 5,
    физика: 4,
    химия: 5
};

чоп.сабт(бахоҳои_донишҷӯ.математика);  // 5
```

## 10.10. Generic Types (Намудҳои умумӣ)

Generics имкон медиҳанд, ки компонентҳои аз нав истифодашавандаро эҷод кунед.

```somonscript
// Функсияи generic
функсия охирин<Т>(массив: Т[]): Т | беқимат {
    агар (массив.дарозӣ === 0) {
        бозгашт беқимат;
    }
    бозгашт массив[массив.дарозӣ - 1];
}

тағйирёбанда ададҳо: рақам[] = [1, 2, 3, 4, 5];
тағйирёбанда номҳо: сатр[] = ["Аҳмад", "Фотима", "Ҳасан"];

чоп.сабт(охирин(ададҳо));  // 5
чоп.сабт(охирин(номҳо));   // Ҳасан

// Синфи generic
синф Нигоҳдорандаи_қимат<Т> {
    хосусӣ қимат: Т;

    конструктор(қимат: Т) {
        ин.қимат = қимат;
    }

    ҷамъиятӣ гирифтан(): Т {
        бозгашт ин.қимат;
    }

    ҷамъиятӣ танзим_кардан(қимат: Т): холӣ {
        ин.қимат = қимат;
    }
}

тағйирёбанда нигоҳдорандаи_рақам = нав Нигоҳдорандаи_қимат<рақам>(42);
тағйирёбанда нигоҳдорандаи_сатр = нав Нигоҳдорандаи_қимат<сатр>("Салом");

чоп.сабт(нигоҳдорандаи_рақам.гирифтан());  // 42
чоп.сабт(нигоҳдорандаи_сатр.гирифтан());   // Салом
```

## 10.11. Type Guards (Муҳофизатҳои намуд)

```somonscript
функсия сатр_аст(қимат: ҳар): қимат аст сатр {
    бозгашт навъи қимат === "сатр";
}

функсия коркарди_қимат(қимат: сатр | рақам): холӣ {
    агар (сатр_аст(қимат)) {
        чоп.сабт("Дарозӣ: " + қимат.дарозӣ);
    } вагарна {
        чоп.сабт("Дукарат: " + (қимат * 2));
    }
}

коркарди_қимат("Салом");  // Дарозӣ: 5
коркарди_қимат(10);       // Дукарат: 20
```

## 10.12. Мисоли амалӣ

```somonscript
// Системаи намудҳо барои идораи маҳсулот

интерфейс Маҳсулот {
    ид: рақам;
    ном: сатр;
    қимат: рақам;
    дар_ҷой: мантиқӣ;
}

навъ Эҷоди_маҳсулот = Omit<Маҳсулот, "ид">;
навъ Тағйири_маҳсулот = қисмӣ<Маҳсулот>;

синф Идоракунандаи_маҳсулот {
    хосусӣ маҳсулот: Маҳсулот[];
    хосусӣ шумораи_навбатӣ: рақам;

    конструктор() {
        ин.маҳсулот = [];
        ин.шумораи_навбатӣ = 1;
    }

    ҷамъиятӣ илова_кардан(маълумот: Эҷоди_маҳсулот): Маҳсулот {
        тағйирёбанда маҳсулоти_нав: Маҳсулот = {
            ид: ин.шумораи_навбатӣ++,
            ...маълумот
        };
        ин.маҳсулот.илова(маҳсулоти_нав);
        бозгашт маҳсулоти_нав;
    }

    ҷамъиятӣ тағйир_додан(ид: рақам, тағйиротҳо: Тағйири_маҳсулот): мантиқӣ {
        тағйирёбанда индекс: рақам = ин.маҳсулот.findIndex((м: Маҳсулот): мантиқӣ => м.ид === ид);
        агар (индекс !== -1) {
            ин.маҳсулот[индекс] = { ...ин.маҳсулот[индекс], ...тағйиротҳо };
            бозгашт дуруст;
        }
        бозгашт нодуруст;
    }

    ҷамъиятӣ намоиш(): холӣ {
        чоп.сабт("\n=== Феҳристи маҳсулот ===");
        барои (тағйирёбанда и: рақам = 0; и < ин.маҳсулот.дарозӣ; и++) {
            тағйирёбанда м: Маҳсулот = ин.маҳсулот[и];
            тағйирёбанда ҳолат: сатр = м.дар_ҷой ? "Дар ҷой" : "Тамом шуд";
            чоп.сабт(`${м.ид}. ${м.ном} - ${м.қимат} сомонӣ [${ҳолат}]`);
        }
    }
}

// Истифода
тағйирёбанда идоракунанда = нав Идоракунандаи_маҳсулот();

идоракунанда.илова_кардан({
    ном: "Китоб",
    қимат: 50,
    дар_ҷой: дуруст
});

идоракунанда.илова_кардан({
    ном: "Қалам",
    қимат: 5,
    дар_ҷой: дуруст
});

идоракунанда.намоиш();
идоракунанда.тағйир_додан(1, { қимат: 45 });
идоракунанда.намоиш();
```

## 10.13. Хулоса

Дар ин боб шумо омӯхтед:
- Намудҳои union ва intersection
- Намудҳои tuple
- Намудҳои utility (Partial, Required, Pick, Omit, Record)
- Generic types
- Type guards
- Системаи пешрафтаи намудҳо

---

**Машқҳо:**

1. Интерфейсе барои "Китоб" эҷод кунед ва бо намудҳои utility кор кунед
2. Функсияи generic созед, ки ду массивро якҷоя мекунад
3. Системаи намудҳо барои идораи донишҷӯён бо union ва intersection types эҷод кунед
4. Синфи generic барои Queue (навбат) созед
